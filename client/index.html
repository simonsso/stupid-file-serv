<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Simple fileserver demo</title>
    <style>
        body {
          background-color: linen;
        }

        h1 {
          color: maroon;
          margin-left: 40px;
          font-family: Arial, Helvetica, sans-serif;
        }
        h2 {
          color: maroon;
          margin-left: 40px;
          font-family: Arial, Helvetica, sans-serif;
        }
        input, textarea {
            border: 1px solid black;
            margin: 0;
            padding: 0;
            width: 400px;
        }
        div {
          margin-left: 40px;
          /* border:4px dotted blue; */
        }
        table {
          /* border: 4px dotted red; */
        }
        button {
          margin-left: 20px;
        }
    </style>

   
  </head>
  <body>

    <h1>Demonstation simple file server</h1>
    <h2>File list</h2>

    <!-- Load React. -->
    <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js" crossorigin></script>
    <script src="button.js"></script>

    <div id='content'>
    <script type='text/jsx'>
    class PostComment extends React.Component {
      constructor(props) {
          super(props);
          this.state = { value: props.value, filename: props.filename };
          this.handleChangeFileName = this.handleChangeFileName.bind(this);
          this.handleChangeContent = this.handleChangeContent.bind(this);

          this.handleSubmit = this.handleSubmit.bind(this);
      }

      handleChangeFileName(e,prop) {
          e.preventDefault();
          this.setState({ filename: e.target.value  });
      }

      handleChangeContent(e) {
        e.preventDefault();
        this.setState({ value: e.target.value  });
      }

      handleSubmit(e) {
          e.preventDefault();
          // e.target.body.value = '';
          const data = this.state.value;
          let filename = this.state.filename;
          this.state.filename = "random_filename"+ (Math.floor(Math.random() *100 )) + ".txt";
          e.target.filename.value = this.state.filename


          return fetch('http://localhost:5000/files/'+filename, {
              method: 'POST',
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'text/plain',
              },
              body: [data]
            }).then(responese => {
              if (! responese.ok) {
                 window.alert("Error posting file, check if "+filename+" already exists");
              }else{
                request_full_tab();
              }
            });
      }

      render() {
          return (
              <form onSubmit={this.handleSubmit} ref={el => (this.myFormRef = el)}>
                 <input onChange={this.handleChangeFileName}  type="text" name="filename" rows="1" cols="50" value={this.state.filename}/><br/>
                  <textarea
                      rows="3"
                      name="body"
                      value={this.state.value}
                      onChange={this.handleChangeContent}
                  /><br/>
                  <button className="btn" type="submit">
                      Comment
                  </button>
              </form>
          );
      }
    } 

    ReactDOM.render(e(PostComment,{value:"Hello",filename:"example0.txt"}), document.getElementById("uploadform") );

    request_full_tab();
    </script>
     
    <ul id=bartab>
    </ul> </div>
    <h2>Upload files</h2>
    <div id="uploadform"></div>
    
  </body>
</html>